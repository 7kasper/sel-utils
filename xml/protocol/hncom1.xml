<?xml version="1.0" encoding="utf-8"?>

<protocol software="Hub-Node Communication" version="1">

	<description>
		Communication between hub and nodes.
	</description>

	<encoding id="ubyte" arrayLength="varuint">

		<endianness type="*" value="bigEndian" />

		<alias name="hubId" type="varuint" />

		<type name="plugin">
			<field name="name" type="string" />
			<field name="version" type="string" />
		</type>

		<type name="address">
			<field name="bytes" type="ubyte[]" />
			<field name="port" type="ushort" />
		</type>

		<type name="game">
			<field name="type" type="ubyte" />
			<field name="protocols" type="uint[]" />
			<field name="motd" type="string" />
			<field name="port" type="ushort" />
		</type>

		<type name="skin">
			<field name="name" type="string" />
			<field name="data" type="ubyte[]" />
		</type>

		<type name="log">
			<field name="timestamp" type="ulong" />
			<field name="logger" type="string" />
			<field name="message" type="string" />
		</type>

	</encoding>

	<packets>

		<section name="login">

			<packet name="connection" id="0" clientbound="false" serverbound="true">
				<field name="protocol" type="varuint">
					Version of the protocol used by the client that must match the hub's one
				</field>
				<field name="name" type="string">
					Name of the node that will be validated by the hub.
				</field>
				<field name="mainNode" type="bool">
					Indicates whether the node accepts clients when they first connect to the hub or only when they are manually transferred.
				</field>
			</packet>

			<packet name="connectionResponse" id="1" clientbound="true" serverbound="false">
				<field name="protocolAccepted" type="bool" />
				<field name="nameAccepted" type="bool" />
			</packet>

			<packet name="info" id="2" clientbound="true" serverbound="false">
				<field name="serverId" type="long" />
				<field name="onlineMode" type="bool" />
				<field name="displayName" type="string" />
				<field name="games" type="game[]" />
				<field name="online" type="varuint" />
				<field name="max" type="varuint" />
				<field name="language" type="string" />
				<field name="acceptedLanguages" type="string[]" />
				<field name="nodes" type="string[]" />
				<field name="socialJson" type="string" />
				<field name="additionalJson" type="string" />
			</packet>

			<packet name="ready" id="3" clientbound="false" serverbound="true">
				<field name="plugins" type="plugin[]" />
			</packet>

		</section>

		<section name="status">

			<packet name="players" id="4" clientbound="true" serverbound="false">
				<field name="online" type="varuint" />
				<field name="max" type="varuint" />
			</packet>

			<packet name="nodes" id="5" clientbound="true" serverbound="false">
				<field name="action" type="ubyte">
					<constant name="add" value="0" />
					<constant name="remove" value="1" />
				</field>
				<field name="node" type="string" />
			</packet>

			<packet name="resourcesUsage" id="6" clientbound="true" serverbound="false">
				<field name="tps" type="float" />
				<field name="ram" type="varulong" />
				<field name="cpu" type="float" />
			</packet>

		</section>

		<section name="generic">

			<packet name="logs" id="7" clientbound="false" serverbound="true">
				<field name="messages" type="log[]" />
			</packet>

			<packet name="remoteCommand" id="8" clientbound="true" serverbound="false">
				<field name="origin" type="ubyte">
					<constant name="hub" value="0" />
					<constant name="externalConsole" value="1" />
					<constant name="rcon" value="2" />
				</field>
				<field name="sender" type="address" />
				<field name="command" type="string" />
			</packet>

			<packet name="update_list" id="9" clientbound="false" serverbound="true">
				<field name="list" type="ubyte">
					<constant name="whitelist" value="0" />
					<constant name="blacklist" value="1" />
				</field>
				<field name="action" type="ubyte">
					<constant name="add" value="0" />
					<constant name="remove" value="1" />
				</field>
				<field name="type" type="ubyte" />
				<variants field="type">
					<variant name="byHubId" value="0">
						<field name="hubId" type="hubId" />
					</variant>
					<variant name="byName" value="1">
						<field name="username" type="string" />
					</variant>
					<variant name="bySuuid" value="2">
						<field name="game" type="ubyte" />
						<field name="uuid" type="uuid" />
					</variant>
				</variants>
			</packet>

		</section>

		<section name="player">

			<packet name="add" id="10" clientbound="true" serverbound="false">
				<field name="hubId" type="hubId" />
				<field name="reason" type="ubyte">
					<constant name="firstJoin" value="0" />
					<constant name="transferred" value="1" />
					<constant name="forciblyTransferred" value="2" />
				</field>
				<field name="protocol" type="varuint" />
				<field name="username" type="string" />
				<field name="displayName" type=" string" />
				<field name="address" type="address" />
				<field name="game" type="ubyte" />
				<field name="uuid" type="uuid" />
				<field name="skin" type="skin" />
				<field name="latency" type="varuint" />
				<field name="packetLoss" type="float" />
				<field name="language" type="string" />
			</packet>

			<packet name="remove" id="11" clientbound="true" serverbound="false">
				<field name="hubId" type="hubId" />
				<field name="reason" type="ubyte">
					<constant name="left" value="0" />
					<constant name="timedOut" value="1" />
					<constant name="kicked" value="2" />
					<constant name="transferred" value="3" />
				</field>
			</packet>

			<packet name="kick" id="12" clientbound="false" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="reason" type="string" />
				<field name="translation" type="bool" />
			</packet>

			<packet name="transfer" id="13" clientbound="false" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="node" type="string" />
			</packet>

			<packet name="updateLanguage" id="14" clientbound="false" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="language" type="string" />
			</packet>

			<packet name="updateDisplayName" id="15" clientbound="false" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="displayName" type="string" />
			</packet>

			<packet name="updateLatency" id="16" clientbound="true" serverbound="false">
				<field name="hubId" type="hubId" />
				<field name="latency" type="varuint" />
			</packet>

			<packet name="updatePacketLoss" id="17" clientbound="true" serverbound="false">
				<field name="hubId" type="hubId" />
				<field name="packetLoss" type="float" />
			</packet>

			<packet name="gamePacket" id="18" clientbound="true" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="packet" type="bytes" />
			</packet>

			<packet name="orderedGamePacket" id="19" clientbound="false" serverbound="true">
				<field name="hubId" type="hubId" />
				<field name="order" type="varuint" />
				<field name="packet" type="bytes" />
			</packet>

		</section>

	</packets>

</protocol>
