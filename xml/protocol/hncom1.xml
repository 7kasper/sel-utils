<?xml version="1.0" encoding="utf-8"?>

<protocol>

	<software>Hub-Node Communication</software>

	<protocol>1</protocol>

	<released>2017/1/7</released>

	<from>1.0.0</from>

	<description>
		Communication between hub and nodes.
	</description>

	<encoding id="ubyte" arraylength="varuint">

		<endianness type="*" value="big-endian" />

		<alias name="hub-id" type="varuint" />

		<type name="plugin">
			<field name="name" type="string" />
			<field name="version" type="string" />
		</type>

		<type name="address">
			Internet protocol address. Could be either version 4 and 6.
			<field name="bytes" type="ubyte[]">
				Bytes of the address. The length may be 4 (for ipv4 addresses) or 16 (for ipv6 addresses). The byte order is always big-endian (network order).
			</field>
			<field name="port" type="ushort">
				Port of the address.
			</field>
		</type>

		<type name="game">
			<field name="type" type="ubyte">
				<constant name="pocket" value="1" />
				<constant name="minecraft" value="2" />
			</field>
			<field name="protocols" type="uint[]" />
			<field name="motd" type="string" />
			<field name="port" type="ushort" />
		</type>

		<type name="skin">
			<field name="name" type="string" />
			<field name="data" type="ubyte[]" />
		</type>

		<type name="log">
			<field name="timestamp" type="ulong" />
			<field name="logger" type="string" />
			<field name="message" type="string" />
		</type>

	</encoding>

	<packets>

		<section name="login">

			<packet name="connection" id="0" clientbound="false" serverbound="true">
				<field name="protocol" type="varuint">
					Version of the protocol used by the client that must match the hub's one
				</field>
				<field name="name" type="string">
					Name of the node that will be validated by the hub.
				</field>
				<field name="main-node" type="bool">
					Indicates whether the node accepts clients when they first connect to the hub or exclusively when they are manually transferred.
				</field>
			</packet>

			<packet name="connection-response" id="1" clientbound="true" serverbound="false">
				<field name="protocol-accepted" type="bool" />
				<field name="name-accepted" type="bool" />
			</packet>

			<packet name="info" id="2" clientbound="true" serverbound="false">
				<field name="server-id" type="ulong" />
				<field name="display-name" type="string" />
				<field name="online-mode" type="bool" />
				<field name="games" type="game[]" />
				<field name="online" type="varuint" />
				<field name="max" type="varuint" />
				<field name="language" type="string" />
				<field name="accepted-languages" type="string[]" />
				<field name="nodes" type="string[]" />
				<field name="social-json" type="string" />
				<field name="additional-json" type="string" />
			</packet>

			<packet name="ready" id="3" clientbound="false" serverbound="true">
				<field name="plugins" type="plugin[]" />
			</packet>

		</section>

		<section name="status">

			<packet name="players" id="4" clientbound="true" serverbound="false">
				<field name="online" type="varuint" />
				<field name="max" type="varuint" />
			</packet>

			<packet name="nodes" id="5" clientbound="true" serverbound="false">
				<field name="action" type="ubyte">
					<constant name="add" value="0" />
					<constant name="remove" value="1" />
				</field>
				<field name="node" type="string" />
			</packet>

			<packet name="resources-usage" id="6" clientbound="true" serverbound="false">
				<field name="tps" type="float" />
				<field name="ram" type="varulong" />
				<field name="cpu" type="float" />
			</packet>

		</section>

		<section name="generic">

			<packet name="logs" id="7" clientbound="false" serverbound="true">
				<field name="messages" type="log[]" />
			</packet>

			<packet name="remote-command" id="8" clientbound="true" serverbound="false">
				<field name="origin" type="ubyte">
					<constant name="hub" value="0" />
					<constant name="external-console" value="1" />
					<constant name="rcon" value="2" />
				</field>
				<field name="sender" type="address" />
				<field name="command" type="string" />
			</packet>

			<packet name="update-list" id="9" clientbound="false" serverbound="true">
				<field name="list" type="ubyte">
					<constant name="whitelist" value="0" />
					<constant name="blacklist" value="1" />
				</field>
				<field name="action" type="ubyte">
					<constant name="add" value="0" />
					<constant name="remove" value="1" />
				</field>
				<field name="type" type="ubyte" />
				<variants field="type">
					<variant name="by-hub-id" value="0">
						<field name="hub-id" type="hub-id" />
					</variant>
					<variant name="by-name" value="1">
						<field name="username" type="string" />
					</variant>
					<variant name="by-suuid" value="2">
						<field name="game" type="ubyte">
							<constant name="pocket" value="1" />
							<constant name="minecraft" value="2" />
						</field>
						<field name="uuid" type="uuid" />
					</variant>
				</variants>
			</packet>

		</section>

		<section name="player">

			<packet name="add" id="10" clientbound="true" serverbound="false">
				<field name="hub-id" type="hub-id" />
				<field name="reason" type="ubyte">
					<constant name="first-join" value="0" />
					<constant name="transferred" value="1" />
					<constant name="forcibly-transferred" value="2" />
				</field>
				<field name="protocol" type="varuint" />
				<field name="username" type="string" />
				<field name="display-name" type="string" />
				<field name="address" type="address" />
				<field name="game" type="ubyte">
					<constant name="pocket" value="1" />
					<constant name="minecraft" value="2" />
				</field>
				<field name="uuid" type="uuid" />
				<field name="skin" type="skin" />
				<field name="latency" type="varuint" />
				<field name="packet-loss" type="float" />
				<field name="language" type="string" />
			</packet>

			<packet name="remove" id="11" clientbound="true" serverbound="false">
				<field name="hub-id" type="hub-id" />
				<field name="reason" type="ubyte">
					<constant name="left" value="0" />
					<constant name="timed-out" value="1" />
					<constant name="kicked" value="2" />
					<constant name="transferred" value="3" />
				</field>
			</packet>

			<packet name="kick" id="12" clientbound="false" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="reason" type="string" />
				<field name="translation" type="bool" />
			</packet>

			<packet name="transfer" id="13" clientbound="false" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="node" type="string" />
			</packet>

			<packet name="update-language" id="14" clientbound="false" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="language" type="string" />
			</packet>

			<packet name="update-display-name" id="15" clientbound="false" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="display-name" type="string" />
			</packet>

			<packet name="update-latency" id="16" clientbound="true" serverbound="false">
				<field name="hub-id" type="hub-id" />
				<field name="latency" type="varuint" />
			</packet>

			<packet name="update-packet-loss" id="17" clientbound="true" serverbound="false">
				<field name="hub-id" type="hub-id" />
				<field name="packet-loss" type="float" />
			</packet>

			<packet name="game-packet" id="18" clientbound="true" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="packet" type="bytes" />
			</packet>

			<packet name="ordered-game-packet" id="19" clientbound="false" serverbound="true">
				<field name="hub-id" type="hub-id" />
				<field name="order" type="varuint" />
				<field name="packet" type="bytes" />
			</packet>

		</section>

	</packets>

</protocol>
