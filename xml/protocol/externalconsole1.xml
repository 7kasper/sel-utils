<?xml version="1.0" encoding="utf-8"?>

<protocol software="External Console" version="1">

	<description>
		Protocol used by SEL to communicate with external sources using TCP or web sockets.
	</description>

	<encoding id="ubyte" arrayLength="ushort">

		<endianness type="*" value="bigEndian" />
		
		<type name="game">
			<field name="type" type="ubyte"></field>
			<field name="protocols" type="uint[]"></field>
		</type>

	</encoding>

	<packets>

		<section name="login">

			<packet name="authCredentials" id="0" clientbound="true" serverbound="false">
				<description>
					Credentials for login.
				</description>
				<field name="protocol" type="ubyte">
					Protocol used by the server. If the client uses a different one it should close the connection without sending any packet.
				</field>
				<field name="hashAlgorithm" type="string">
					Algorithm used by the server to match the the hash. If empty no hashing is done and the password is sent raw.
				</field>
				<field name="payload" type="ubyte[16]">
					Payload to add to the password encoded as UTF-8 (if hashAlgorithm is not empty) before hashing it.
				</field>
			</packet>

			<packet name="auth" id="1" clientbound="false" serverbound="true">
				<field name="hash" type="ubyte[]"></field>
			</packet>

			<packet name="welcome" id="2" clientbound="true" serverbound="false">
				<field name="status" type="ubyte"></field>
				<variants field="status">
					<variant name="accepted" value="0">
						<description>

						</description>
						<field name="remoteCommands" type="bool"></field>
						<field name="software" type="string"></field>
						<field name="versions" type="ubyte[3]"></field>
						<field name="protocols" type="game[]"></field>
						<field name="connectedNodes" type="string[]"></field>
					</variant>
					<variant name="wrongHash" value="1">

					</variant>
					<variant name="timedOut" value="2">

					</variant>
				</variants>
			</packet>

		</section>

		<section name="status">

			<packet name="keepAlive" id="0" clientbound="true" serverbound="true">
				<field name="count" type="uint"></field>
			</packet>

			<packet name="updateNodes" id="1" clientbound="true" serverbound="false">
				<field name="action" type="ubyte"></field>
				<field name="node" type="string"></field>
			</packet>

			<packet name="updateStats" id="2" clientbound="true" serverbound="false">
				<field name="displayName" type="string"></field>
				<field name="onlinePlayers" type="uint"></field>
				<field name="maxPlayers" type="uint"></field>
				<field name="uptime" type="uint"></field>
				<field name="upload" type="uint"></field>
				<field name="download" type="uint"></field>
			</packet>

		</section>

		<section name="play">

			<packet name="consoleMessage" id="3" clientbound="true" serverbound="false">
				<description>
					Logs a message from the server's console. It may be a result of a command, a debug message or any other message that the server retains able to be seen by the External Console.
				</description>
				<field name="node" type="string">
					Name of the node that has created the log or an empty string if the log has been created by the hub or by a server implementation that isn't based on the hub-node structure.
				</field>
				<field name="timestamp" type="ulong">
					Unix timestamp in milliseconds that indicates the exact time when the log has been generated by the server.
				</field>
				<field name="logger" type="string">
					Name of the logger. It is the world name if the log has been generated by a world's message (like a broadcast or a chat message).
				</field>
				<field name="message" type="string">
					The logged message. It may contain Minecraft's formatting codes which should be translated into appropriate colours by the client-side implementation.
				</field>
			</packet>

			<packet name="command" id="4" clientbound="false" serverbound="false">
				<description>
					Executes a command remotely if the server allows it. If not a [Permission Denied](#permission-denied) is sent back. The ideal client should never send this packet if remoteCommands field in [Welcome.Accepted](#accepted) is not true.
				</description>
				<field name="command" type="string">
					Command to be executed on the server. On SEL servers it should start with a slash or a point (hub command) or a node name followed by the command (node command).
				</field>
			</packet>

			<packet name="permissionDenied" id="5" clientbound="true" serverbound="false">
				<description>
					Bodyless packet only sent in response to [Command](#command) when the server doesn't allow the execution of remote commands through the External Console protocol. The ideal client should never receive this packet avoiding the use of [Command](#command) if the remoteCommands field in [Welcome.Accepted](#accepted) is not true.
				</description>
			</packet>

		</section>

	</packets>

</protocol>
